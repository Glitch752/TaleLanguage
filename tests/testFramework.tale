let std = import("std");

let test = function(name) {
    let module = import("testModules/" + name);
    let testName = module.TEST_NAME;
    let expectedAssertions = module.EXPECTED_ASSERTIONS;
    
    let assertionsRun = 0;
    let anyAssertionsFailed = false;
    let assert = function(condition) {
        assertionsRun = assertionsRun + 1;
        if (!condition) {
            std.println("\x1b[1;31m  Test '" + testName + "': Assertion failed\x1b[0m");
            anyAssertionsFailed = true;
        }
    };

    module.run(assert);

    if (anyAssertionsFailed) {
        std.println("\x1b[1;31m! Test '" + testName + "' failed: Some assertions failed\x1b[0m");
        return;
    }

    if (assertionsRun != expectedAssertions) {
        std.println("\x1b[1;31m! Test '" + testName + "' failed: Expected " + expectedAssertions + " assertions, but ran " + assertionsRun + "\x1b[0m");
        return;
    }

    std.println("\x1b[1;32m! Test '" + testName + "' passed!\x1b[0m");

    return;
};

test("functionCall");